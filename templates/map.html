<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
     <!-- Load Leaflet from CDN-->
     <link rel="stylesheet" href="/static/css/leaflet.css" />
     <script src="/static/lib/js/leaflet.js"></script>
    <!-- Load Esri Leaflet locally, after cloning this repository -->
     <script src="/static/js/jquery.js" type="text/javascript"></script>
    <script src="/static/lib/js/esri-leaflet.js"></script>

    <style>
      html, body, #map {
        margin:0; padding:0;  width : 100%; height : 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
    var map = L.map('map').setView([45.528, -122.680], 13);


    L.esri.basemapLayer("Gray").addTo(map);

    var parks = L.esri.featureLayer({
      url: "https://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/Portland_Parks/FeatureServer/0",
      style: function () {
        return { color: "#70ca49", weight: 2 };
      }
    }).addTo(map);

    var popupTemplate = "<h3>{NAME}</h3>{ACRES} Acres<br><small>Property ID: {PROPERTYID}<small>";

    parks.bindPopup(function(e){
      return L.Util.template(popupTemplate, e.feature.properties)
    });
    var wellmaxzoom = 11;
    var geojsonLayerWells = new L.GeoJSON();

    function loadGeoJson(data) {
        console.log(data);
        geojsonLayerWells.addData(data);
        map.addLayer(geojsonLayerWells);
    };

    map.on('moveend', function(){
     if(map.getZoom() > wellmaxzoom){
        var geoJsonUrl ='http://115.159.93.53:8080/geoserver/tiger/ows';
        var defaultParameters = {
            service: 'WFS',
            version: '1.1.0',
            request: 'GetFeature',
            typeName: 'tiger:poly_landmarks',
            maxFeatures: 3000,
            outputFormat: 'application/json'
            };

        var customParams = {
            bbox: map.getBounds().toBBoxString(),
           };
        var parameters = L.Util.extend(defaultParameters, customParams);
        console.log(geoJsonUrl + L.Util.getParamString(parameters));

        $.ajax({
            url: geoJsonUrl + L.Util.getParamString(parameters),
            datatype: 'json',
            jsonCallback: 'getJson',
            success: loadGeoJson
            });
        }else{
        map.removeLayer(geojsonLayerWells);
        };
    });




    </script>
  </body>
</html>
